<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Know Quran - Surah & Juz Viewer</title>
<link rel="icon" href="images/quran.png">
<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Noto+Naskh+Arabic:wght@400;600&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
*{box-sizing:border-box;margin:0;padding:0;}
body{font-family:'Poppins',sans-serif;background:#f0f7f0;color:#1b5e20;min-height:100vh;display:flex;flex-direction:column;transition:all 0.3s;}
header{background:linear-gradient(90deg,#1b5e20,#d4a017);color:white;text-align:center;padding:20px;font-size:1.8em;font-weight:600;display:flex;align-items:center;justify-content:center;gap:10px;}
header i{font-size:1.3em;}
#welcome{text-align:center;padding:30px;}
#welcome i{font-size:5em;color:#1b5e20;margin-bottom:20px;}
#welcome h1{font-size:2.2em;margin-bottom:20px;}
#welcome p{font-size:1.1em;margin-bottom:30px;}
#welcome button{padding:15px 35px;font-size:1.2em;border:none;border-radius:30px;cursor:pointer;margin:5px;}
#startBtn{background:linear-gradient(90deg,#1b5e20,#d4a017);color:white;transition:all 0.3s;}
#startBtn:hover{transform:scale(1.05);}
#exitBtn{background:#d32f2f;color:white;transition:all 0.3s;}
#exitBtn:hover{transform:scale(1.05);}
.controls{text-align:center;margin:15px;display:none;flex-wrap:wrap;justify-content:center;gap:10px;}
.controls select,.controls input,.controls button{padding:10px 20px;border:none;border-radius:25px;background:white;color:#1b5e20;font-size:1em;min-width:200px;outline:none;transition:all 0.3s;cursor:pointer;}
.controls select:hover,.controls input:hover,.controls button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.2);}
.search-container{position:relative;}
.search-container i{position:absolute;left:20px;top:50%;transform:translateY(-50%);color:#1b5e20;}
.search-container input{padding-left:50px;min-width:250px;}
.container{max-width:900px;margin:20px auto;padding:20px;position:relative;overflow-y:auto;flex-grow:1;display:none;transition:all 0.3s;}
.close-button{position:absolute;top:10px;right:10px;background:#d32f2f;color:white;border:none;border-radius:50%;width:40px;height:40px;font-size:1.2em;cursor:pointer;display:none;transition:all 0.3s;}
.close-button:hover{transform:scale(1.1);}
.ayah{background:white;border-radius:15px;margin:15px 0;padding:20px;box-shadow:0 4px 15px rgba(0,0,0,0.1);transition:all 0.3s;}
.ayah:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.15);}
.arabic{font-family:'Noto Naskh Arabic','Amiri',serif;font-size:2em;color:#1b5e20;direction:rtl;text-align:right;margin-bottom:15px;line-height:2.2em;}
.bismillah{text-align:center;color:#d4a017;font-family:'Noto Naskh Arabic',serif;font-size:2.5em;margin:20px 0;}
.footer{background:linear-gradient(90deg,#1b5e20,#d4a017);color:white;text-align:center;padding:15px;margin-top:auto;}
.loading-spinner{display:flex;justify-content:center;align-items:center;gap:10px;padding:20px;font-size:1.2em;color:#d4a017;font-weight:600;}
.loading-spinner i{animation:spin 1s linear infinite;}
@keyframes spin{100%{transform:rotate(360deg);} }
.saved-list{margin-top:10px;}
.saved-item{background:white;padding:10px 15px;margin:5px;border-radius:10px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 2px 10px rgba(0,0,0,0.1);}
.saved-item button{background:#d32f2f;color:white;border:none;border-radius:10px;padding:5px 10px;cursor:pointer;margin-left:5px;}
#savedNotification{position:fixed;top:20px;right:20px;background:#1b5e20;color:white;padding:15px 25px;border-radius:30px;display:none;opacity:0;transition:all 0.5s;z-index:9999;}
.back-btn{background:#1b5e20;color:white;border:none;border-radius:20px;padding:8px 15px;margin-bottom:10px;cursor:pointer;}
#savedSearch{padding:8px 15px;margin:10px auto;display:block;border-radius:20px;border:1px solid #1b5e20;width:90%;max-width:400px;outline:none;}
.delete-all{background:#d32f2f;color:white;border:none;border-radius:20px;padding:8px 15px;margin:10px;cursor:pointer;}
#loadingScreen{position:fixed;top:0;left:0;width:100%;height:100%;background:#f0f7f0;display:flex;justify-content:center;align-items:center;z-index:10000;}
@media(max-width:768px){.arabic{font-size:1.6em;}.controls select,.controls input,.controls button{width:90%;margin-bottom:10px;}}
</style>
</head>
<body>

<header><i class="fas fa-book-open"></i> The Know Quran - Surah & Juz Viewer</header>

<div id="loadingScreen" class="loading-spinner">
  <i class="fas fa-spinner"></i> Loading...
</div>

<div id="welcome">
  <i class="fas fa-quran"></i>
  <h1>Welcome to The Know Quran</h1>
  <p>Select Surah or Juz to start reading or search below.</p>
  <button id="startBtn">Start Reading</button>
  <button id="exitBtn">Back to Home</button>
</div>

<div class="controls" id="controls">
  <select id="surahSelect"><option value="">Select Surah</option></select>
  <select id="juzSelect"><option value="">Select Juz</option></select>
  <div class="search-container">
    <i class="fas fa-search"></i>
    <input type="text" id="searchInput" placeholder="Search Surah/Juz">
  </div>
  <button id="saveBtn">Save</button>
  <button id="clearBtn">Clear</button>
  <button id="viewSavedBtn">View Saved</button>
  <button id="logoutBtn">Back to Home</button>
</div>

<div class="container" id="content">
  <button class="close-button" id="closeBtn"><i class="fas fa-times"></i></button>
</div>

<div class="container" id="savedContainer">
  <button class="back-btn" id="backFromSaved"><i class="fas fa-arrow-left"></i> Back</button>
  <h2 style="text-align:center;color:#1b5e20;margin-bottom:10px;">Saved Surahs & Juz</h2>
  <input type="text" id="savedSearch" placeholder="Search saved items">
  <button class="delete-all" id="deleteAllSaved">Delete All</button>
  <div id="savedList" class="saved-list"></div>
  <p id="noSaved" style="text-align:center;color:#d32f2f;display:none;">No saved items found.</p>
</div>

<div id="savedNotification">Saved!</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBdDjvZ7uFQ-htfeqpCQqVrD71mroy5SKM",
  authDomain: "knowquran-dae08.firebaseapp.com",
  databaseURL: "https://knowquran-dae08-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "knowquran-dae08",
  storageBucket: "knowquran-dae08.appspot.com",
  messagingSenderId: "613613995179",
  appId: "1:613613995179:web:2cf706aaf05cbe5a3ae3ee"
};
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const startBtn=document.getElementById('startBtn');
const exitBtn=document.getElementById('exitBtn');
const welcomeDiv=document.getElementById('welcome');
const controlsDiv=document.getElementById('controls');
const contentDiv=document.getElementById('content');
const closeBtn=document.getElementById('closeBtn');
const logoutBtn=document.getElementById('logoutBtn');
const saveBtn=document.getElementById('saveBtn');
const clearBtn=document.getElementById('clearBtn');
const viewSavedBtn=document.getElementById('viewSavedBtn');
const savedContainer=document.getElementById('savedContainer');
const backFromSaved=document.getElementById('backFromSaved');
const savedList=document.getElementById('savedList');
const noSaved=document.getElementById('noSaved');
const savedNotification=document.getElementById('savedNotification');
const surahSelect=document.getElementById('surahSelect');
const juzSelect=document.getElementById('juzSelect');
const searchInput=document.getElementById('searchInput');
const savedSearch=document.getElementById('savedSearch');
const deleteAllSaved=document.getElementById('deleteAllSaved');
const loadingScreen=document.getElementById('loadingScreen');

let allSurahs=[];

function showWelcome(){
  loadingScreen.style.display='flex';
  welcomeDiv.style.display='none';
  controlsDiv.style.display='none';
  contentDiv.style.display='none';
  savedContainer.style.display='none';
  setTimeout(()=>{ loadingScreen.style.display='none'; welcomeDiv.style.display='block'; },500);
}

function goToHomeImmediate(){
  window.location.href='quran.html';
}

startBtn.addEventListener('click',()=>{ welcomeDiv.style.display='none'; controlsDiv.style.display='flex'; contentDiv.style.display='block'; });
exitBtn.addEventListener('click', goToHomeImmediate);
logoutBtn.addEventListener('click', goToHomeImmediate);
closeBtn.addEventListener('click', goToHomeImmediate);
backFromSaved.addEventListener('click', ()=>{ savedContainer.style.display='none'; controlsDiv.style.display='flex'; contentDiv.style.display='block'; });
viewSavedBtn.addEventListener('click',()=>{ contentDiv.style.display='none'; controlsDiv.style.display='none'; savedContainer.style.display='block'; });
clearBtn.addEventListener('click',()=>{ surahSelect.value=''; juzSelect.value=''; searchInput.value=''; contentDiv.innerHTML=''; closeBtn.style.display='none'; });

async function fetchSurahs(){
  try{
    const res=await fetch('https://api.alquran.cloud/v1/surah');
    const data=await res.json();
    allSurahs=data.data;
    allSurahs.forEach(s=>{ const opt=document.createElement('option'); opt.value=s.number; opt.textContent=`${s.number}. ${s.englishName} (${s.name})`; surahSelect.appendChild(opt); });
  }catch(e){ contentDiv.innerHTML="<p style='color:red;text-align:center;'>Failed to load Surahs</p>"; }
}

function populateJuz(){ for(let i=1;i<=30;i++){ const opt=document.createElement('option'); opt.value=i; opt.textContent=`Juz ${i}`; juzSelect.appendChild(opt); } }

async function loadSurah(number){
  if(!number){contentDiv.innerHTML='';closeBtn.style.display='none';return;}
  contentDiv.innerHTML="<div class='loading-spinner'><i class='fas fa-spinner'></i> Loading Surah...</div>";
  closeBtn.style.display='block';
  try{
    const res=await fetch(`https://api.alquran.cloud/v1/surah/${number}`);
    const data=await res.json();
    contentDiv.innerHTML='';
    if(number!=9){const b=document.createElement('div');b.className='bismillah';b.textContent='﷽';contentDiv.appendChild(b);}
    data.data.ayahs.forEach(a=>{const d=document.createElement('div');d.className='ayah';d.innerHTML=`<div class="arabic">${a.text}</div>`;contentDiv.appendChild(d);});
  }catch(e){contentDiv.innerHTML="<p style='color:red;text-align:center;'>Error loading Surah</p>";}
}

async function loadJuz(number){
  if(!number){contentDiv.innerHTML='';closeBtn.style.display='none';return;}
  contentDiv.innerHTML="<div class='loading-spinner'><i class='fas fa-spinner'></i> Loading Juz...</div>";
  closeBtn.style.display='block';
  try{
    const res=await fetch(`https://api.alquran.cloud/v1/juz/${number}`);
    const data=await res.json();
    contentDiv.innerHTML='';
    data.data.ayahs.forEach(a=>{const d=document.createElement('div');d.className='ayah';d.innerHTML=`<div class="arabic">${a.text}</div>`;contentDiv.appendChild(d);});
  }catch(e){contentDiv.innerHTML="<p style='color:red;text-align:center;'>Error loading Juz</p>";}
}

surahSelect.addEventListener('change',()=>{ loadSurah(surahSelect.value); juzSelect.value=''; searchInput.value=''; });
juzSelect.addEventListener('change',()=>{ loadJuz(juzSelect.value); surahSelect.value=''; searchInput.value=''; });

searchInput.addEventListener('input',()=>{ 
  const term=searchInput.value.toLowerCase().trim();
  if(!term){ surahSelect.value=''; juzSelect.value=''; contentDiv.innerHTML=''; return; }
  const surahMatch=allSurahs.find(s=>s.englishName.toLowerCase().includes(term)||s.name.toLowerCase().includes(term)||s.number.toString()===term);
  if(surahMatch){ loadSurah(surahMatch.number); surahSelect.value=surahMatch.number; juzSelect.value=''; return; }
  const juzNumber=parseInt(term);
  if(juzNumber>=1 && juzNumber<=30){ loadJuz(juzNumber); surahSelect.value=''; juzSelect.value=juzNumber; return; }
  contentDiv.innerHTML="<p style='color:red;text-align:center;'>No match found</p>";
});

saveBtn.addEventListener('click',()=>{
  const type=surahSelect.value?`Surah`:`Juz`;
  const name=surahSelect.value?surahSelect.options[surahSelect.selectedIndex].text:juzSelect.options[juzSelect.selectedIndex].text;
  if(!name){alert('Please select Surah or Juz to save.'); return;}
  push(ref(db,'saved'),{type,name});
  savedNotification.style.display='block';
  savedNotification.style.opacity='1';
  setTimeout(()=>{ savedNotification.style.opacity='0'; setTimeout(()=>{ savedNotification.style.display='none'; },500); },1000);
  loadSaved();
});

function loadSaved(){
  savedList.innerHTML=''; noSaved.style.display='none';
  onValue(ref(db,'saved'),snapshot=>{
    savedList.innerHTML='';
    if(!snapshot.exists()){ noSaved.style.display='block'; return; }
    snapshot.forEach(child=>{
      const data=child.val();
      const id=child.key;
      const div=document.createElement('div');
      div.className='saved-item';
      div.innerHTML=`<span>${data.type}: ${data.name}</span>`;
      const delBtn=document.createElement('button');
      delBtn.textContent='Delete';
      delBtn.addEventListener('click',()=>{ if(confirm('Are you sure you want to delete this item?')) remove(ref(db,'saved/'+id)); });
      div.appendChild(delBtn);
      savedList.appendChild(div);
    });
  });
}

savedSearch.addEventListener('input',()=>{
  const term=savedSearch.value.toLowerCase().trim();
  const items=savedList.querySelectorAll('.saved-item');
  items.forEach(item=>{ const text=item.querySelector('span').textContent.toLowerCase(); item.style.display=text.includes(term)?'flex':'none'; });
});

deleteAllSaved.addEventListener('click',()=>{ if(confirm('Are you sure you want to delete ALL saved items?')) remove(ref(db,'saved')); });

// Init
fetchSurahs();
populateJuz();
loadSaved();
showWelcome();
</script>

<div class="footer">© 2025 The Know Quran | Designed By Suhaim Soft</div>
</body>
</html>
